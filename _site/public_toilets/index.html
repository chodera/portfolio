<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/favicon.ico?v=2">

<title>Public toilets in Strasbourg | David Witkowski</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Public toilets in Strasbourg | Portfolio</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Public toilets in Strasbourg" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ever wandered around a city desperately looking for a public toilet? Fear not, the open data movement is here to help. The city of Strasbourg recently opened a new open data portal and while checking their available data sets I came across the one about public toilets. I guess every city should leak information about their public toilets." />
<meta property="og:description" content="Ever wandered around a city desperately looking for a public toilet? Fear not, the open data movement is here to help. The city of Strasbourg recently opened a new open data portal and while checking their available data sets I came across the one about public toilets. I guess every city should leak information about their public toilets." />
<link rel="canonical" href="http://localhost:4000/public_toilets/" />
<meta property="og:url" content="http://localhost:4000/public_toilets/" />
<meta property="og:site_name" content="Portfolio" />
<meta property="og:image" content="http://localhost:4000/assets/images/toilet.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-03-23T00:00:00+01:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/public_toilets/"},"@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"}},"image":"http://localhost:4000/assets/images/toilet.jpg","url":"http://localhost:4000/public_toilets/","headline":"Public toilets in Strasbourg","dateModified":"2019-03-23T00:00:00+01:00","datePublished":"2019-03-23T00:00:00+01:00","description":"Ever wandered around a city desperately looking for a public toilet? Fear not, the open data movement is here to help. The city of Strasbourg recently opened a new open data portal and while checking their available data sets I came across the one about public toilets. I guess every city should leak information about their public toilets.","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">

<link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto+Slab" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">

<div class="site-content">

<div class="container">

  <!-- Begin Menu Navigation
  ================================================== -->
  <nav class="navbar navbar-expand navbar-light bg-white fixed-top mediumnavigation nav-down">

      <div class="container pr-0">

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>


      <div class="collapse navbar-collapse" id="navbarMediumish">

          <!-- Begin Menu -->

              <ul class="navbar-nav ml-auto">

                  
                  <li class="nav-item">
                  
                  <a class="nav-link" href="/about">About</a>
                  </li>

              </ul>

          <!-- End Menu -->

      </div>

      </div>
  </nav>
  <!-- End Navigation
  ================================================== -->



<!-- Site Title
================================================== -->
<div class="mainheading">
<a class="mainheading" href="/">
    <h1 class="sitetitle"><a class="black" href="/">David Witkowski</h1>
</a>
    <p class="lead">
         Portfolio of data-related projects
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    
<!-- Begin Article
================================================== -->
<div class="container">
	<div class="row">

		<!-- Post Share -->
		<div class="col-md-2 pl-0">
           <div class="share">
    <p>
        Contact
    </p>
    <ul>
      <li class="ml-1 mr-1">
      <a class="link-ft" href="mailto:david.witkowski@posteo.net">
      <i class="fas fa-envelope" ></i>
      </a>
      </li>

      <li class="ml-1 mr-1">
      <a class="link-ft" target="_blank" href="https://www.linkedin.com/in/david-witkowski-2bb3a4157/">
      <i class="fab fa-linkedin"></i>
      </a>
      </li>

        <li class="ml-1 mr-1">
        <a class="link-ft" target="_blank" href="https://github.com/chodera">
        <i class="fab fa-github"></i>
        </a>
        </li>

    </ul>

</div>

		</div>


		<!-- Post -->
        

		<div class="col-md-9 flex-first flex-md-unordered">
			<div class="mainheading">

      <!-- Post Title -->
				<h1 class="posttitle">Public toilets in Strasbourg</h1>

			</div>

			<!-- Post Featured Image -->
			
				<img class="featured-image img-fluid" src="http://localhost:4000/assets/images/toilet.jpg" alt="Public toilets in Strasbourg">
				
			
			<!-- End Featured Image -->

			<!-- Post Content -->
			<div class="article-post">
				<p>Ever wandered around a city desperately looking for a public toilet? Fear not, the open data movement is here to help. The city of Strasbourg recently opened a new open data portal and while checking their available data sets I came across the one about public toilets. I guess every city should leak information about their public toilets.</p>

<p>I accessed the data by using an API and made a little map showing where to find the toilets.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Load packages</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create response object</span><span class="w">
</span><span class="n">url</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://data.strasbourg.eu/api/records/1.0/search/?dataset=lieux_toilettes_publiques"</span><span class="w">
</span><span class="n">raw.result</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">

</span><span class="c1"># Check response object</span><span class="w">
</span><span class="n">status_code</span><span class="p">(</span><span class="n">raw.result</span><span class="p">)</span><span class="w">

</span><span class="c1"># Access raw json data and transform into data frame</span><span class="w">
</span><span class="n">json_text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">content</span><span class="p">(</span><span class="n">raw.result</span><span class="p">,</span><span class="w"> </span><span class="s2">"text"</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">fromJSON</span><span class="p">(</span><span class="n">json_text</span><span class="p">))</span><span class="w">
</span><span class="n">records</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fromJSON</span><span class="p">(</span><span class="n">json_text</span><span class="p">)</span><span class="o">$</span><span class="n">records</span><span class="w">
</span><span class="n">toilettes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">records</span><span class="o">$</span><span class="n">fields</span><span class="w">

</span><span class="c1"># Check data and select necessary variables</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">toilettes</span><span class="p">)</span><span class="w">
</span><span class="n">toilettes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">toilettes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">point_geo</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">geometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point_geo</span><span class="p">)</span><span class="w">

</span><span class="c1"># Get rid of part of the string and capitalize the first letter of the remaining part</span><span class="w">
</span><span class="n">firstup</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">substr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">toupper</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
  </span><span class="n">x</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">toilettes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">toilettes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">firstup</span><span class="p">(</span><span class="n">str_split</span><span class="p">(</span><span class="n">toilettes</span><span class="o">$</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s2">"Toilettes publiques "</span><span class="p">,</span><span class="w"> </span><span class="n">simplify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)[,</span><span class="m">2</span><span class="p">]))</span><span class="w">

</span><span class="c1"># Check data again</span><span class="w">
</span><span class="n">toilettes</span><span class="w">
</span><span class="c1"># There are 10 public toilets in Strasbourg</span><span class="w">

</span><span class="c1"># Let's plot them on a map</span><span class="w">

</span><span class="c1"># First, extract geographic location and save as dataframe</span><span class="w">
</span><span class="n">geo_seq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">toilettes</span><span class="o">$</span><span class="n">geometry</span><span class="p">)</span><span class="w">
</span><span class="n">lat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">geo_seq</span><span class="p">[</span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">geo_seq</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)]</span><span class="w">
</span><span class="n">lon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">geo_seq</span><span class="p">[</span><span class="n">seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">geo_seq</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)]</span><span class="w">

</span><span class="n">toilettes_geo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">toilettes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lon</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">lon</span><span class="p">)</span><span class="w">
</span><span class="n">toilettes_geo</span><span class="w">

</span><span class="n">toilettes_sf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_as_sf</span><span class="p">(</span><span class="n">toilettes_geo</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"lon"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lat"</span><span class="p">),</span><span class="w">
                   </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4326</span><span class="p">,</span><span class="w"> </span><span class="n">agr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"constant"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Second, get the background map</span><span class="w">
</span><span class="c1"># Find coordinates with the website https://boundingbox.klokantech.com/</span><span class="w">
</span><span class="n">stras_map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_map</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">7.716782</span><span class="p">,</span><span class="m">48.564086</span><span class="p">,</span><span class="m">7.787678</span><span class="p">,</span><span class="m">48.600426</span><span class="p">),</span><span class="w">
                     </span><span class="n">maptype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"toner-background"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Third, combine the two geographic data sets</span><span class="w">
</span><span class="n">ggmap</span><span class="p">(</span><span class="n">stras_map</span><span class="p">,</span><span class="w"> </span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"device"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_sf</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toilettes_sf</span><span class="p">,</span><span class="w">
          </span><span class="n">inherit.aes</span><span class="w"> </span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
          </span><span class="n">colour</span><span class="o">=</span><span class="s2">"#238443"</span><span class="p">,</span><span class="w">
          </span><span class="n">fill</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w">
          </span><span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span><span class="w">
          </span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w">
          </span><span class="n">shape</span><span class="o">=</span><span class="m">21</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text_repel</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toilettes_sf</span><span class="p">,</span><span class="w">
            </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">),</span><span class="w">
            </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.9</span><span class="p">,</span><span class="w">
            </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w">
            </span><span class="n">fontface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
            </span><span class="n">nudge_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-0.004</span><span class="p">,</span><span class="w">
            </span><span class="n">nudge_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">+0.0007</span><span class="p">)</span><span class="w">

</span><span class="c1"># One toilet is not on the map, it is the one it Schiltigheim, which is in the north of Strasbourg.</span></code></pre></figure>

<p>Here is the final result:</p>

<p><img src="../assets/images/toilettes.png" alt="toilet_map" /></p>

<p>PS: Public toilets in France are <strong>free</strong>.</p>

<p>Get the code <a href="https://github.com/chodera/chodera.github.io/blob/master/assets/projects/4.%20Public%20Toilets%20in%20Strasbourg/strasbourg_toilettes.R" target="_blank">here</a>.</p>

			</div>

		</div>
		<!-- End Post -->

	</div>
</div>
<!-- End Article
================================================== -->


</div>



<!-- Begin Footer
================================================== -->

<footer class="footer">

<!--   <div class="content">

              <div class="inner">
                <a class="link-ft" target="_blank" href="https://jekyllrb.com/">Jekyll</a>
                <aclass="link-ft">Â·</a>
                  <a class="link-ft" target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish</a>
              </div>

      </div>-->
</footer>
<!-- End Footer
================================================== -->


<!-- Scripts
================================================== -->

<script src="/assets/js/scrolldown.js"></script>

</body>
</html>
